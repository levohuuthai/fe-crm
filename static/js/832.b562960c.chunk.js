(self.webpackChunkfe_crm=self.webpackChunkfe_crm||[]).push([[832],{50477:()=>{},94084:(e,t,n)=>{"use strict";n.d(t,{z:()=>K,A:()=>Q});var o=n(89379),l=n(65043),r=n(94799),i=n(53969),s=n(55895),a=n(41859),c=n(42579),d=n(22672),h=n(61773),u=n(74917),f=n(28330),x=n(22950),b=n(5362),p=n(7549),g=n(44990),m=n(90954),j=n(16727),A=n(40848),y=n(32127),C=n(58432),v=n(3757),S=n(83442),w=n(70846),k=n(63697),E=n(79430),R=n(46699),T=n(83974),W=n(41329),L=n(76678),N=n(3555),B=n(28442),P=n(95613),D=n(20312),z=n(51491),Y=n(5297),F=n(70579);const H=e=>{let{content:t,onChange:n,readOnly:o=!1}=e;const r=(0,l.useRef)(null),s=(0,g.hG)({extensions:[m.A,j.A,A.Ay.configure({inline:!0,allowBase64:!0}),y.Ay.configure({resizable:!0}),C.A,v.h,S.A],content:t,onUpdate:e=>{let{editor:t}=e;n(t.getHTML())},editable:!o}),a=(0,l.useCallback)(()=>{null===s||void 0===s||s.chain().focus().insertTable({rows:3,cols:3,withHeaderRow:!0}).run()},[s]),d=(0,l.useCallback)(()=>{null===s||void 0===s||s.chain().focus().addColumnBefore().run()},[s]),h=(0,l.useCallback)(()=>{null===s||void 0===s||s.chain().focus().addColumnAfter().run()},[s]),u=(0,l.useCallback)(()=>{null===s||void 0===s||s.chain().focus().addRowBefore().run()},[s]),f=(0,l.useCallback)(()=>{null===s||void 0===s||s.chain().focus().addRowAfter().run()},[s]),x=(0,l.useCallback)(()=>{null===s||void 0===s||s.chain().focus().deleteRow().run()},[s]),p=(0,l.useCallback)(()=>{null===s||void 0===s||s.chain().focus().deleteColumn().run()},[s]),H=(0,l.useCallback)(()=>{null===s||void 0===s||s.chain().focus().deleteTable().run()},[s]);return s?(0,F.jsxs)(i.A,{sx:{border:"1px solid #e0e0e0",borderRadius:1,overflow:"hidden"},children:[(0,F.jsxs)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5,p:1,borderBottom:"1px solid #e0e0e0",bgcolor:"#f5f5f5"},children:[(0,F.jsxs)(w.A,{size:"small",variant:"text",children:[(0,F.jsx)(c.A,{onClick:()=>s.chain().focus().toggleBold().run(),color:s.isActive("bold")?"primary":"default",title:"\u0110\u1eadm",children:(0,F.jsx)(k.A,{})}),(0,F.jsx)(c.A,{onClick:()=>s.chain().focus().toggleItalic().run(),color:s.isActive("italic")?"primary":"default",title:"Nghi\xeang",children:(0,F.jsx)(E.A,{})}),(0,F.jsx)(c.A,{onClick:()=>s.chain().focus().toggleUnderline().run(),color:s.isActive("underline")?"primary":"default",title:"G\u1ea1ch ch\xe2n",children:(0,F.jsx)(k.A,{sx:{textDecoration:"underline"}})})]}),(0,F.jsxs)(w.A,{size:"small",variant:"text",children:[(0,F.jsx)(c.A,{onClick:()=>s.chain().focus().toggleBulletList().run(),color:s.isActive("bulletList")?"primary":"default",title:"Danh s\xe1ch kh\xf4ng th\u1ee9 t\u1ef1",children:(0,F.jsx)(R.A,{})}),(0,F.jsx)(c.A,{onClick:()=>s.chain().focus().toggleOrderedList().run(),color:s.isActive("orderedList")?"primary":"default",title:"Danh s\xe1ch c\xf3 th\u1ee9 t\u1ef1",children:(0,F.jsx)(T.A,{})})]}),(0,F.jsxs)(w.A,{size:"small",variant:"text",children:[(0,F.jsx)(c.A,{onClick:a,title:"Ch\xe8n b\u1ea3ng",children:(0,F.jsx)(W.A,{})}),(0,F.jsx)(c.A,{onClick:u,disabled:!s.can().addRowBefore(),title:"Th\xeam h\xe0ng ph\xeda tr\xean",children:(0,F.jsx)(L.A,{})}),(0,F.jsx)(c.A,{onClick:f,disabled:!s.can().addRowAfter(),title:"Th\xeam h\xe0ng ph\xeda d\u01b0\u1edbi",children:(0,F.jsx)(N.A,{})}),(0,F.jsx)(c.A,{onClick:d,disabled:!s.can().addColumnBefore(),title:"Th\xeam c\u1ed9t b\xean tr\xe1i",children:(0,F.jsx)(B.A,{})}),(0,F.jsx)(c.A,{onClick:h,disabled:!s.can().addColumnAfter(),title:"Th\xeam c\u1ed9t b\xean ph\u1ea3i",children:(0,F.jsx)(P.A,{})}),(0,F.jsx)(c.A,{onClick:x,disabled:!s.can().deleteRow(),title:"X\xf3a h\xe0ng",children:(0,F.jsx)(b.A,{})}),(0,F.jsx)(c.A,{onClick:p,disabled:!s.can().deleteColumn(),title:"X\xf3a c\u1ed9t",children:(0,F.jsx)(b.A,{})}),(0,F.jsx)(c.A,{onClick:H,disabled:!s.can().deleteTable(),title:"X\xf3a b\u1ea3ng",children:(0,F.jsx)(W.A,{})})]}),(0,F.jsx)(w.A,{size:"small",variant:"text",children:(0,F.jsx)(c.A,{onClick:()=>{var e;return null===(e=r.current)||void 0===e?void 0:e.click()},title:"Ch\xe8n \u1ea3nh",children:(0,F.jsx)(D.A,{})})}),(0,F.jsxs)(w.A,{size:"small",variant:"text",children:[(0,F.jsx)(c.A,{onClick:()=>s.chain().focus().undo().run(),disabled:!s.can().undo(),title:"Ho\xe0n t\xe1c",children:(0,F.jsx)(z.A,{})}),(0,F.jsx)(c.A,{onClick:()=>s.chain().focus().redo().run(),disabled:!s.can().redo(),title:"L\xe0m l\u1ea1i",children:(0,F.jsx)(Y.A,{})})]})]}),(0,F.jsx)(i.A,{sx:{p:2,minHeight:"300px",maxHeight:"70vh",overflowY:"auto","& .ProseMirror":{"& table":{borderCollapse:"collapse",margin:"1rem 0",width:"100%",tableLayout:"fixed"},"& table td, & table th":{border:"1px solid #ccc",padding:"8px 12px",position:"relative",textAlign:"left",verticalAlign:"top"},"& table th":{backgroundColor:"#f3f3f3",fontWeight:"bold"},"& table .selectedCell":{backgroundColor:"rgba(200, 200, 255, 0.4)"}}},children:(0,F.jsx)(g.$Z,{editor:s})}),(0,F.jsx)("input",{type:"file",ref:r,style:{display:"none"},accept:"image/*",onChange:e=>{var t;const n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!n)return;const o=new FileReader;o.onload=e=>{var t;const n=null===(t=e.target)||void 0===t?void 0:t.result;null===s||void 0===s||s.chain().focus().setImage({src:n}).run()},o.readAsDataURL(n)}})]}):(0,F.jsx)("div",{children:"\u0110ang t\u1ea3i tr\xecnh so\u1ea1n th\u1ea3o..."})};p.KQ.register({family:"Roboto",fonts:[{src:"https://cdnjs.cloudflare.com/ajax/libs/ink/3.1.10/fonts/Roboto/roboto-regular-webfont.ttf",fontWeight:"normal"},{src:"https://cdnjs.cloudflare.com/ajax/libs/ink/3.1.10/fonts/Roboto/roboto-bold-webfont.ttf",fontWeight:"bold"},{src:"https://cdnjs.cloudflare.com/ajax/libs/ink/3.1.10/fonts/Roboto/roboto-italic-webfont.ttf",fontStyle:"italic"}]}),p.KQ.register({family:"NotoSans",fonts:[{src:"https://cdn.jsdelivr.net/npm/@fontsource/noto-sans@4.5.1/files/noto-sans-vietnamese-400-normal.woff",fontWeight:"normal"},{src:"https://cdn.jsdelivr.net/npm/@fontsource/noto-sans@4.5.1/files/noto-sans-vietnamese-700-normal.woff",fontWeight:"bold"}]}),p.KQ.register({family:"SourceSansPro",fonts:[{src:"https://cdn.jsdelivr.net/npm/source-sans-pro@3.6.0/TTF/SourceSansPro-Regular.ttf",fontWeight:"normal"},{src:"https://cdn.jsdelivr.net/npm/source-sans-pro@3.6.0/TTF/SourceSansPro-Bold.ttf",fontWeight:"bold"},{src:"https://cdn.jsdelivr.net/npm/source-sans-pro@3.6.0/TTF/SourceSansPro-Italic.ttf",fontStyle:"italic"},{src:"https://cdn.jsdelivr.net/npm/source-sans-pro@3.6.0/TTF/SourceSansPro-BoldItalic.ttf",fontWeight:"bold",fontStyle:"italic"}]}),p.KQ.registerHyphenationCallback(e=>[e]);const I=297*3.78,O="10mm",U=p.vv.create({page:{flexDirection:"column",backgroundColor:"#ffffff",padding:30,fontFamily:"SourceSansPro"},section:{margin:10,padding:10,flexGrow:1},title:{fontSize:24,fontWeight:"bold",marginBottom:20,textAlign:"center",fontFamily:"SourceSansPro"},subtitle:{fontSize:18,fontWeight:"bold",marginBottom:10,fontFamily:"SourceSansPro"},text:{fontSize:12,marginBottom:5,fontFamily:"SourceSansPro"},table:{width:"auto",borderStyle:"solid",borderWidth:1,borderColor:"#bfbfbf",marginVertical:10},tableRow:{flexDirection:"row"},tableHeaderCell:{backgroundColor:"#f0f0f0",fontWeight:"bold",padding:5,borderStyle:"solid",borderWidth:1,borderColor:"#bfbfbf",fontFamily:"SourceSansPro"},tableCell:{padding:5,borderStyle:"solid",borderWidth:1,borderColor:"#bfbfbf",fontFamily:"SourceSansPro"},pageNumber:{position:"absolute",fontSize:10,bottom:20,right:20,textAlign:"right",color:"grey",fontFamily:"SourceSansPro"}}),X=e=>{let{element:t}=e;switch(t.type){case"heading1":return(0,F.jsx)(p.EY,{style:U.title,children:t.content});case"heading2":return(0,F.jsx)(p.EY,{style:U.subtitle,children:t.content});case"paragraph":case"text":return(0,F.jsx)(p.EY,{style:U.text,children:t.content});case"bold":return(0,F.jsx)(p.EY,{style:(0,o.A)((0,o.A)({},U.text),{},{fontWeight:"bold"}),children:t.content});case"italic":return(0,F.jsx)(p.EY,{style:(0,o.A)((0,o.A)({},U.text),{},{fontStyle:"italic"}),children:t.content});case"underline":return(0,F.jsx)(p.EY,{style:(0,o.A)((0,o.A)({},U.text),{},{textDecoration:"underline"}),children:t.content});case"table":return(0,F.jsx)(p.Ss,{style:U.table,children:t.rows.map((e,t)=>(0,F.jsx)(p.Ss,{style:U.tableRow,children:e.cells.map((t,n)=>{const o=t.isHeader||e.isHeader?U.tableHeaderCell:U.tableCell;return(0,F.jsx)(p.Ss,{style:[o,{flex:1}],children:(0,F.jsx)(p.EY,{children:t.content})},n)})},t))});case"bulletList":return(0,F.jsx)(p.Ss,{style:{marginLeft:10},children:t.items.map((e,t)=>(0,F.jsxs)(p.Ss,{style:{flexDirection:"row",marginBottom:5},children:[(0,F.jsx)(p.EY,{style:{marginRight:5},children:"\u2022"}),(0,F.jsx)(p.EY,{style:U.text,children:e})]},t))});case"numberedList":return(0,F.jsx)(p.Ss,{style:{marginLeft:10},children:t.items.map((e,t)=>(0,F.jsxs)(p.Ss,{style:{flexDirection:"row",marginBottom:5},children:[(0,F.jsxs)(p.EY,{style:{marginRight:5},children:[t+1,"."]}),(0,F.jsx)(p.EY,{style:U.text,children:e})]},t))});case"container":return(0,F.jsx)(p.Ss,{children:t.children.map((e,t)=>(0,F.jsx)(X,{element:e},t))});default:return null}},M=e=>{let{pages:t}=e;return(0,F.jsx)(p.yo,{children:t.map((e,t)=>{const n=(e=>{const t=(new DOMParser).parseFromString(e,"text/html"),n=[],o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(e.nodeType===Node.TEXT_NODE){var n;const t=null===(n=e.textContent)||void 0===n?void 0:n.trim();return t?{type:"text",content:t}:null}if(e.nodeType===Node.ELEMENT_NODE){const n=e,l=n.tagName.toLowerCase();switch(l){case"h1":return{type:"heading1",content:n.textContent||""};case"h2":return{type:"heading2",content:n.textContent||""};case"p":return{type:"paragraph",content:n.textContent||""};case"strong":case"b":return{type:"bold",content:n.textContent||""};case"em":case"i":return{type:"italic",content:n.textContent||""};case"u":return{type:"underline",content:n.textContent||""};case"table":const e=[];return n.querySelectorAll("tr").forEach((t,n)=>{const o=[],l=0===n||t.querySelector("th");t.querySelectorAll("th, td").forEach(e=>{o.push({content:e.textContent||"",isHeader:"th"===e.tagName.toLowerCase()})}),e.push({cells:o,isHeader:l})}),{type:"table",rows:e};case"ul":case"ol":const r=[];return n.querySelectorAll("li").forEach(e=>{r.push(e.textContent||"")}),{type:"ul"===l?"bulletList":"numberedList",items:r};default:const i=[];return n.childNodes.forEach(e=>{const n=o(e,t+1);n&&i.push(n)}),i.length>0?{type:"container",children:i}:null}}return null};return t.body.childNodes.forEach(e=>{const t=o(e);t&&n.push(t)}),n})(e);return(0,F.jsx)(p.YW,{size:"A4",style:U.page,children:(0,F.jsxs)(p.Ss,{style:U.section,children:[n.map((e,t)=>(0,F.jsx)(X,{element:e},t)),(0,F.jsxs)(p.EY,{style:U.pageNumber,children:["Trang ",t+1]})]})},t)})})},q=e=>{let{content:t,pageNumber:n,isEditing:o,onContentChange:l}=e;return(0,F.jsxs)(r.A,{elevation:2,className:"pdf-page","data-page-number":n,sx:{width:"".concat(793.8,"px"),minHeight:"".concat(I,"px"),maxWidth:"100%",padding:O,margin:"0 0 20px 0",position:"relative",backgroundColor:"white",boxSizing:"border-box",display:"flex",flexDirection:"column","@media print":{boxShadow:"none",margin:0,padding:O,pageBreakAfter:"always","&:last-child":{pageBreakAfter:"auto"}}},children:[(0,F.jsx)(i.A,{sx:{flex:1,overflow:"hidden","& .ProseMirror":{overflow:"hidden !important",height:"100%","& table":{borderCollapse:"collapse",margin:"1rem 0",width:"100%",tableLayout:"fixed",border:"1px solid #000"},"& table td, & table th":{border:"1px solid #000",padding:"8px 12px",position:"relative",textAlign:"left",verticalAlign:"top"},"& table th":{backgroundColor:"#f3f3f3",fontWeight:"bold"}}},children:(0,F.jsx)(H,{content:t,onChange:e=>{l(e)},readOnly:!o})}),(0,F.jsxs)(i.A,{sx:{position:"absolute",bottom:10,right:10,fontSize:"12px",color:"#666",backgroundColor:"rgba(255, 255, 255, 0.8)",px:1,borderRadius:1},children:["Trang ",n]})]})},K=e=>{let{initialContent:t,onSave:n,onExportPdf:o}=e;const[r,g]=(0,l.useState)(t),[m,j]=(0,l.useState)(!0),A=(0,l.useRef)(null);(0,l.useEffect)(()=>{0===t.length&&g(["<p>Nh\u1eadp n\u1ed9i dung t\u1ea1i \u0111\xe2y...</p>"])},[t]);return(0,F.jsxs)(i.A,{sx:{display:"flex",height:"calc(100vh - 48px)",bgcolor:"#f8f9fa",overflow:"hidden"},children:[(0,F.jsxs)(i.A,{sx:{width:250,bgcolor:"white",p:2,boxShadow:1,display:"flex",flexDirection:"column",gap:2,overflowY:"auto"},children:[(0,F.jsx)(s.A,{variant:"h6",sx:{fontWeight:"bold",mb:2,color:"primary.main"},children:"T\xe0i li\u1ec7u"}),(0,F.jsx)(a.A,{variant:"contained",fullWidth:!0,onClick:()=>{const e=!m;j(e),!1===e&&n(r)},startIcon:m?(0,F.jsx)(d.A,{}):(0,F.jsx)(h.A,{}),sx:{mb:1,justifyContent:"flex-start"},children:m?"L\u01b0u thay \u0111\u1ed5i":"Ch\u1ec9nh s\u1eeda"}),(0,F.jsx)(a.A,{variant:"outlined",fullWidth:!0,onClick:async()=>{try{const e=(0,F.jsx)(M,{pages:r}),t=await(0,p.x8)(e).toBlob(),n=URL.createObjectURL(t),l=document.createElement("a");l.href=n,l.download="bao-gia.pdf",l.click(),setTimeout(()=>URL.revokeObjectURL(n),100),o&&o()}catch(e){console.error("L\u1ed7i khi xu\u1ea5t PDF:",e)}},startIcon:(0,F.jsx)(u.A,{}),sx:{mb:1,justifyContent:"flex-start"},children:"Xu\u1ea5t PDF"}),(0,F.jsx)(a.A,{variant:"outlined",fullWidth:!0,onClick:()=>{window.print()},startIcon:(0,F.jsx)(f.A,{}),sx:{mb:3,justifyContent:"flex-start"},children:"In t\xe0i li\u1ec7u"}),m&&(0,F.jsx)(a.A,{variant:"contained",color:"primary",fullWidth:!0,onClick:()=>{g([...r,"<p>Nh\u1eadp n\u1ed9i dung t\u1ea1i \u0111\xe2y...</p>"])},startIcon:(0,F.jsx)(x.A,{}),sx:{mt:"auto",mb:2},children:"Th\xeam trang m\u1edbi"})]}),(0,F.jsx)(i.A,{sx:{flex:1,p:3,overflowY:"auto",overflowX:"hidden",display:"flex",flexDirection:"column",alignItems:"center"},children:(0,F.jsx)(i.A,{ref:A,sx:{width:"fit-content",maxWidth:"100%",bgcolor:"transparent",p:0},children:r.map((e,t)=>(0,F.jsxs)(i.A,{sx:{position:"relative",mb:4,"&:hover .page-actions":{opacity:1}},children:[(0,F.jsx)(q,{content:e,pageNumber:t+1,isEditing:m,onContentChange:e=>((e,t)=>{const n=[...r];n[e]=t,g(n)})(t,e)}),m&&(0,F.jsx)(i.A,{className:"page-actions",sx:{position:"absolute",top:8,right:8,display:"flex",gap:1,opacity:0,transition:"opacity 0.2s","&:hover":{opacity:1}},children:(0,F.jsx)(c.A,{onClick:()=>(e=>{if(r.length<=1)return;const t=[...r];t.splice(e,1),g(t)})(t),size:"small",sx:{backgroundColor:"error.light",color:"white","&:hover":{backgroundColor:"error.dark"}},disabled:r.length<=1,title:"X\xf3a trang",children:(0,F.jsx)(b.A,{fontSize:"small"})})})]},t))})})]})},Q=K}}]);
//# sourceMappingURL=832.b562960c.chunk.js.map